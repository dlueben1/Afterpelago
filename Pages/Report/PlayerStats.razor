@page "/report/players"
@using Afterpelago.Utilities
@using Afterpelago.Models

<article style="display: flex; flex-direction: row; padding: 4em; overflow-y: auto; max-height: 90vh;" Class="mt-16">
    <MudGrid>
        <!-- Player Name -->
        <MudItem xs="12" sm="6" md="9">
            <MudText Typo="Typo.h3">@CurrentPlayer.PlayerName</MudText>
        </MudItem>

        <!-- Player Selection -->
        <MudItem xs="12" sm="6" md="3">
            <MudSelect T="Slot" Label="Select Player" Variant="Variant.Filled" ValueChanged="OnPlayerChanged">
                @foreach (var player in Archipelago.Slots.Values)
                {
                    <MudSelectItem T="Slot" Value="@player" Style="max-width: 300px;">@player.PlayerName</MudSelectItem>
                }
            </MudSelect>
        </MudItem>

        <!-- Checks Breakdown (Chart, Data) -->
        <MudItem xs="12" sm="6">
            <MudCard>
                <MudCardHeader>
                    <CardHeaderContent>
                        <MudText Typo="Typo.h6">Checks Breakdown</MudText>
                    </CardHeaderContent>
                </MudCardHeader>
                <MudCardContent>
                    <ApexChart 
                        @ref="checkChart"
                        TItem="BasicStat"
                        Options="checkPercentOptions"
                        Height="300">
                        <ApexPointSeries TItem="BasicStat"
                                         Items="@CurrentPlayer.MethodOfChecksFound"
                                         SeriesType="SeriesType.Donut"
                                         XValue="@(e => e.Label)"
                                         YValue="@(e => e.Value)" />
                    </ApexChart>
                    <MudList T="string">
                        <MudListItem Text="Average Checks Per Hour" SecondaryText="@CurrentPlayer.ChecksPerHour.ToString("F2")" />
                        <MudListItem Text="Percentage of Checks Found Normally before Release" SecondaryText="@($"{CurrentPlayer.PercentageOfChecksBeforeRelease.ToString("F2")}%")" />
                        <MudListItem Text="# of Leftover Checks on Release" SecondaryText="@CurrentPlayer.NumberOfChecksFoundByMyRelease.ToString()" />
                        <MudListItem Text="First Item Received" SecondaryText="@($"{CurrentPlayer.FirstItemReceived?.Name} from {CurrentPlayer.FirstItemLogEntry.SenderName}")">
                            <AvatarContent>
                                @if (!string.IsNullOrEmpty(CurrentPlayer.FirstItemReceived.Img))
                                {
                                    <img src="@CurrentPlayer.FirstItemReceived.ImageEndpoint" width="48" height="48" />
                                }
                                else
                                {
                                    <MudIcon Icon="@Icons.Material.Filled.EmojiEvents" />
                                }
                            </AvatarContent>
                        </MudListItem>
                    </MudList>
                </MudCardContent>
            </MudCard>
        </MudItem>

        <MudItem xs="12" sm="6">
            <MudCard>
                <MudCardHeader>
                    <CardHeaderContent>
                        <MudText Typo="Typo.h6">Earned Medals</MudText>
                    </CardHeaderContent>
                </MudCardHeader>
                <MudCardContent>
                    <MudList T="string">
                        @foreach (var medal in CurrentPlayer.Medals)
                        {
                            <MudListItem Text="@medal.Name" SecondaryText="@medal.Description" Icon="@medal.Icon" />
                        }
                        @if (CurrentPlayer.Medals.Count == 0)
                        {
                            <MudListItem Text="No Medals Earned" />
                        }
                    </MudList>
                </MudCardContent>
            </MudCard>
        </MudItem>
    </MudGrid>
</article>